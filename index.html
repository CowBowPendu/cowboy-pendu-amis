<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cowboy Pendu Tour par Tour ðŸ¤ </title>
<style>
body { font-family: Arial; background:#eee; text-align:center; }
#game { background:white; padding:20px; margin:20px auto; width:450px; border-radius:10px; }
#word { font-size:32px; letter-spacing:10px; margin:20px; }
#letters button { width:35px; height:35px; margin:2px; }
#leaderboard { margin-top:20px; text-align:left; max-width:450px; margin-left:auto; margin-right:auto; }
#turn { font-weight:bold; margin-bottom:10px; }
</style>
</head>
<body>

<h1>Cowboy Pendu Tour par Tour ðŸ¤ </h1>

<div id="game">

<div id="menu">
  <input id="name" placeholder="Pseudo"><br><br>
  <button onclick="createRoom()">CrÃ©er</button><br><br>
  <input id="roomInput" placeholder="Code">
  <button onclick="joinRoom()">Rejoindre</button>
  <p id="error"></p>
</div>

<div id="room" style="display:none;">
  <p id="roomCode"></p>
  <p id="turn">Tour de : â€¦</p>
  <div id="word">_ _ _ _</div>
  <div id="letters"></div>
  <p id="status"></p>
  <button onclick="restartGame()">Rejouer</button>
  <div id="leaderboard"><h3>Classement</h3><ul id="scores"></ul></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ðŸ”¥ CONFIG FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8XQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.appspot.com",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d"
});

const db = firebase.database();
const words = ["cowboy","cheval","lasso","saloon","pistolet"];
let roomId="", player="", localWord="", guessed=[], attempts=6, players=[], turnIndex=0;

// ðŸ”¹ CrÃ©er une partie
function createRoom(){
  player = name.value.trim();
  if(!player) return error.textContent="Entre un pseudo";
  roomId = Math.random().toString(36).substring(2,8).toUpperCase();
  localWord = words[Math.floor(Math.random()*words.length)];
  guessed=[]; attempts=6; turnIndex=0;
  let data = {
    word: localWord,
    guessed: [],
    attempts: attempts,
    players: {[player]:0},
    turn: 0
  };
  db.ref("rooms/"+roomId).set(data).then(()=>enterRoom());
}

// ðŸ”¹ Rejoindre
function joinRoom(){
  player = name.value.trim();
  roomId = roomInput.value.trim().toUpperCase();
  if(!player||!roomId) return;
  db.ref("rooms/"+roomId).once("value").then(snap=>{
    if(!snap.exists()) return error.textContent="Partie introuvable";
    let data = snap.val();
    if(!data.players) data.players={};
    if(!data.players[player]) data.players[player]=0;
    db.ref("rooms/"+roomId+"/players").set(data.players).then(()=>enterRoom());
  });
}

// ðŸ”¹ Entrer dans la room
function enterRoom(){
  menu.style.display="none"; room.style.display="block"; roomCode.textContent="Code : "+roomId;
  renderWord(); renderLetters(); renderTurn();

  db.ref("rooms/"+roomId).on("value", snap=>{
    const d = snap.val();
    if(!d) return;
    localWord = d.word; guessed = d.guessed||[]; attempts=d.attempts;
    players = Object.keys(d.players||{}); turnIndex=d.turn||0;
    renderWord(); renderLetters(); renderLeaderboard(d.players||{}); renderTurn();
  });
}

// ðŸ”¹ Affichage du mot
function renderWord(){
  let out="";
  for(let l of localWord){
    out += guessed.includes(l)?l+" ":"_ ";
  }
  word.textContent = out;
  if(attempts<=0) status.textContent="ðŸ’€ Perdu ! Mot : "+localWord;
  else if(!out.includes("_")) status.textContent="ðŸŽ‰ GagnÃ© !";
  else status.textContent="Essais : "+attempts;
}

// ðŸ”¹ Lettres
function renderLetters(){
  letters.innerHTML="";
  if(attempts<=0 || !localWord) return;
  let currentPlayer = players[turnIndex%players.length];
  if(currentPlayer!==player) return; // seulement le joueur actif
  "abcdefghijklmnopqrstuvwxyz".split("").forEach(l=>{
    const btn=document.createElement("button");
    btn.textContent=l;
    btn.disabled = guessed.includes(l);
    btn.onclick=()=>{
      if(guessed.includes(l)) return;
      guessed.push(l);
      if(!localWord.includes(l)) attempts--;
      db.ref("rooms/"+roomId).update({guessed:guessed,attempts:attempts,turn:(turnIndex+1)});
      if(localWord.includes(l)){
        db.ref("rooms/"+roomId+"/players/"+player).transaction(v=>(v||0)+1);
      }
    };
    letters.appendChild(btn);
  });
}

// ðŸ”¹ Classement
function renderLeaderboard(playersData){
  const ul=document.getElementById("scores");
  ul.innerHTML="";
  for(let p in playersData){
    const li=document.createElement("li");
    li.textContent=`${p} : ${playersData[p]} pts`;
    ul.appendChild(li);
  }
}

// ðŸ”¹ Tour actuel
function renderTurn(){
  if(players.length===0) { turn.textContent="Tour de : â€¦"; return; }
  let currentPlayer = players[turnIndex%players.length];
  turn.textContent="Tour de : "+currentPlayer+(currentPlayer===player?" (C'est votre tour !)":"");
}

// ðŸ”¹ Rejouer
function restartGame(){
  localWord = words[Math.floor(Math.random()*words.length)];
  guessed=[]; attempts=6; turnIndex=0;
  db.ref("rooms/"+roomId).update({word:localWord,guessed:[],attempts:6,turn:0});
}
</script>

</body>
</html>
