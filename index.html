<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cowboy Pendu Multijoueur ðŸ¤ </title>

<style>
body { font-family: Arial; background:#f0f0f0; margin:0; padding:0; text-align:center; }
header { background:#8b4513; color:white; padding:15px; }
#game { background:white; max-width:600px; margin:20px auto; padding:20px; border-radius:10px; }
#word { font-size:2em; letter-spacing:8px; margin:20px; }
#letters button { width:40px; height:40px; margin:3px; }
#error { color:red; }
</style>
</head>

<body>

<header>
<h1>Cowboy Pendu Multijoueur ðŸ¤ </h1>
</header>

<div id="game">

<div id="menu">
    <input id="name" placeholder="Pseudo"><br><br>
    <button onclick="createRoom()">CrÃ©er une partie</button><br><br>
    <input id="roomInput" placeholder="Code de la partie">
    <button onclick="joinRoom()">Rejoindre</button>
    <p id="error"></p>
</div>

<div id="room" style="display:none;">
    <p id="roomCode"></p>
    <div id="word"></div>
    <div id="letters"></div>
    <p id="status"></p>
    <button onclick="location.reload()">Quitter</button>
</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ðŸ”¥ CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8XQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.appspot.com",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ðŸŽ® VARIABLES
const words = ["cowboy","cheval","lasso","saloon","pistolet"];
let roomId = "";
let player = "";

// ðŸ†• CRÃ‰ER PARTIE
function createRoom() {
    player = name.value.trim();
    if (!player) return error.textContent = "Entre un pseudo";

    roomId = Math.random().toString(36).substring(2,8).toUpperCase();
    const word = words[Math.floor(Math.random()*words.length)];

    db.ref("rooms/" + roomId).set({
        word: word,
        guessed: [],
        attempts: 6
    }).then(enterRoom);
}

// ðŸ”‘ REJOINDRE
function joinRoom() {
    player = name.value.trim();
    roomId = roomInput.value.trim().toUpperCase();
    if (!player || !roomId) return;

    db.ref("rooms/" + roomId).once("value").then(snap => {
        if (!snap.exists()) return error.textContent = "Partie introuvable";
        enterRoom();
    });
}

// ðŸšª ENTRER DANS LA ROOM
function enterRoom() {
    menu.style.display = "none";
    room.style.display = "block";
    roomCode.textContent = "Code : " + roomId;

    db.ref("rooms/" + roomId).on("value", snap => {
        const data = snap.val();
        if (!data) return;

        // ðŸ”¤ MOT
        let display = "";
        for (let l of data.word) {
            display += data.guessed.includes(l) ? l + " " : "_ ";
        }
        word.textContent = display;

        // ðŸ§  STATUT
        if (data.attempts <= 0) {
            status.textContent = "ðŸ’€ Perdu ! Mot : " + data.word;
        } else if (!display.includes("_")) {
            status.textContent = "ðŸŽ‰ GagnÃ© !";
        } else {
            status.textContent = "Essais restants : " + data.attempts;
        }

        // ðŸ”˜ LETTRES
        letters.innerHTML = "";
        "abcdefghijklmnopqrstuvwxyz".split("").forEach(letter => {
            const btn = document.createElement("button");
            btn.textContent = letter;
            btn.disabled = data.guessed.includes(letter) || data.attempts <= 0;

            btn.onclick = () => {
                if (data.guessed.includes(letter)) return;

                const guessed = [...data.guessed, letter];
                const attempts = data.word.includes(letter)
                    ? data.attempts
                    : data.attempts - 1;

                db.ref("rooms/" + roomId).update({
                    guessed: guessed,
                    attempts: attempts
                });
            };

            letters.appendChild(btn);
        });
    });
}
</script>

</body>
</html>
