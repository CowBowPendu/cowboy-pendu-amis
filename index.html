<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cowboy Pendu Multijoueur</title>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9912335877113055"
     crossorigin="anonymous"></script>
<style>
body {font-family: Arial, sans-serif; background:#f0f0f0; margin:0; padding:0; display:flex; flex-direction:column; align-items:center;}
header {background:#8b4513; color:white; padding:20px; width:100%; text-align:center;}
main {display:flex; flex-direction:column; justify-content:center; margin:20px; width:100%; max-width:800px; align-items:center;}
#home, #game-container {background:white; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); margin:10px; width:100%;}
button {padding:10px 20px; margin:5px; border-radius:5px; border:none; cursor:pointer; font-weight:bold;}
button:hover {opacity:0.8;}
#word-display {font-size:2em; letter-spacing:10px; margin:20px 0;}
#letters button {width:40px; height:40px; margin:2px; font-weight:bold;}
.player-label {display:inline-block; padding:3px 8px; margin:2px; border-radius:5px; color:white; font-weight:bold;}
#leaderboard {margin-top:10px;}
#turn-info {margin:10px 0; font-weight:bold;}
#game-code-display {font-weight:bold; font-size:1.2em; color:#8b4513;}
</style>
</head>
<body>

<header>
<h1>Cowboy Pendu Multijoueur ü§†</h1>
</header>

<main>
<div id="home">
  <p>Entrez votre pseudo :</p>
  <input type="text" id="player-name" placeholder="Pseudo">
  <div>
    <button id="create-game">Cr√©er Partie</button>
    <button id="join-game">Rejoindre Partie</button>
  </div>
  <p id="game-code-display"></p>
  <p>Code de partie (pour rejoindre) :</p>
  <input type="text" id="join-code" placeholder="Code partie">
</div>

<div id="game-container" style="display:none;">
  <canvas id="hangman-canvas" width="200" height="250" style="border:1px solid #333; background:#f0f0f0;"></canvas>
  <div id="word-display">_ _ _ _ _</div>
  <div id="letters"></div>
  <div id="status"></div>
  <p id="turn-info"></p>
  <h3>Joueurs :</h3>
  <div id="players-list"></div>
  <h3>Classement :</h3>
  <ul id="leaderboard"></ul>
  <button id="new-game">Retour au menu</button>
</div>
</main>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// --- Config Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8bXQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.firebasestorage.app",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d",
  measurementId: "G-LZ70952MCL"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- Variables ---
const words = ["cowboy","cheval","lasso","saloon","pistolet"];
let currentWord = "";
let guessedLetters = [];
let maxAttempts = 6;
let attemptsLeft = maxAttempts;
let player, playerColor, gameCode, players=[], turnIndex=0;

const homeDiv = document.getElementById("home");
const gameDiv = document.getElementById("game-container");
const wordDisplay = document.getElementById("word-display");
const lettersDiv = document.getElementById("letters");
const leaderboard = document.getElementById("leaderboard");
const playersListDiv = document.getElementById("players-list");
const turnInfo = document.getElementById("turn-info");
const statusDiv = document.getElementById("status");
const canvas = document.getElementById("hangman-canvas");
const ctx = canvas.getContext("2d");
const gameCodeDisplay = document.getElementById("game-code-display");
const joinCodeInput = document.getElementById("join-code");

// --- Sons ---
const soundWrong = new Audio("https://actions.google.com/sounds/v1/impacts/clang_and_whoosh.ogg");
const soundWin = new Audio("https://actions.google.com/sounds/v1/cartoon/clang.ogg");
const soundLose = new Audio("https://actions.google.com/sounds/v1/cartoon/metal_clang.ogg");

// --- Dessin pendu ---
function drawHangman(errors){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="#333"; ctx.lineWidth=2;
  ctx.beginPath(); ctx.moveTo(20,230); ctx.lineTo(180,230);
  ctx.moveTo(50,230); ctx.lineTo(50,20); ctx.lineTo(130,20); ctx.lineTo(130,50); ctx.stroke();
  if(errors>0){ctx.beginPath();ctx.arc(130,70,20,0,2*Math.PI);ctx.stroke();}
  if(errors>1){ctx.beginPath();ctx.moveTo(130,90);ctx.lineTo(130,150);ctx.stroke();}
  if(errors>2){ctx.beginPath();ctx.moveTo(130,100);ctx.lineTo(100,130);ctx.stroke();}
  if(errors>3){ctx.beginPath();ctx.moveTo(130,100);ctx.lineTo(160,130);ctx.stroke();}
  if(errors>4){ctx.beginPath();ctx.moveTo(130,150);ctx.lineTo(100,190);ctx.stroke();}
  if(errors>5){ctx.beginPath();ctx.moveTo(130,150);ctx.lineTo(160,190);ctx.stroke();}
}

// --- Afficher mot ---
function displayWord(){
  let display="";
  for(let l of currentWord){
    display += guessedLetters.includes(l) ? l+" " : "_ ";
  }
  wordDisplay.textContent = display.trim();
}

// --- G√©n√©rer lettres ---
function generateLetterButtons(){
  lettersDiv.innerHTML="";
  for(let c=97;c<=122;c++){
    const letter = String.fromCharCode(c);
    const btn = document.createElement("button");
    btn.textContent=letter;
    btn.onclick=()=>guessLetter(letter);
    lettersDiv.appendChild(btn);
  }
}

// --- Guess lettre ---
function guessLetter(letter){
  if(guessedLetters.includes(letter)) return;
  const incorrect = !currentWord.includes(letter);
  const updatedLetters=[...guessedLetters, letter];
  const updatedAttempts=attemptsLeft - (incorrect ? 1 : 0);
  const gameOver = updatedAttempts<=0 || !currentWord.split("").some(l => !updatedLetters.includes(l));
  const nextTurn=(turnIndex+1)%players.length;

  db.ref(`games/${gameCode}`).update({
    guessedLetters: updatedLetters,
    attemptsLeft: updatedAttempts,
    turnIndex: nextTurn,
    gameOver: gameOver
  });
}

// --- G√©n√©rer code al√©atoire ---
function generateGameCode(length=6){
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let code="";
  for(let i=0;i<length;i++) code += chars.charAt(Math.floor(Math.random()*chars.length));
  return code;
}

// --- Cr√©er Partie ---
document.getElementById("create-game").onclick=()=>{
  player = document.getElementById("player-name").value||"Joueur";
  playerColor="#"+Math.floor(Math.random()*16777215).toString(16);
  gameCode = generateGameCode();

  currentWord = words[Math.floor(Math.random()*words.length)];
  attemptsLeft = maxAttempts;
  guessedLetters=[];

  db.ref(`games/${gameCode}`).set({
    currentWord: currentWord,
    guessedLetters: guessedLetters,
    attemptsLeft: attemptsLeft,
    turnIndex:0,
    gameOver:false,
    players:[{name:player,color:playerColor}]
  });

  gameCodeDisplay.textContent = "Code de la partie : " + gameCode;
  homeDiv.style.display="none";
  gameDiv.style.display="block";
  generateLetterButtons();
};

// --- Rejoindre Partie ---
document.getElementById("join-game").onclick=()=>{
  player = document.getElementById("player-name").value||"Joueur";
  playerColor="#"+Math.floor(Math.random()*16777215).toString(16);
  gameCode = joinCodeInput.value.trim();
  if(!gameCode){alert("Entrez un code valide"); return;}

  db.ref(`games/${gameCode}/players`).once("value").then(snap=>{
    players = snap.val()||[];
    if(!players.some(p=>p.name===player)){
      players.push({name:player,color:playerColor});
      db.ref(`games/${gameCode}/players`).set(players);
    }
    homeDiv.style.display="none";
    gameDiv.style.display="block";
    generateLetterButtons();
  });
};

// --- Listener Firebase sur la partie ---
function attachGameListener(){
  if(!gameCode) return;
  db.ref(`games/${gameCode}`).on("value", snap=>{
    const gameSnap = snap.val();
    if(!gameSnap) return;

    currentWord = gameSnap.currentWord;
    guessedLetters = gameSnap.guessedLetters;
    attemptsLeft = gameSnap.attemptsLeft;
    turnIndex = gameSnap.turnIndex;
    displayWord();
    drawHangman(maxAttempts - attemptsLeft);

    // Joueurs
    players = gameSnap.players || [];
    playersListDiv.innerHTML="";
    players.forEach(p=>{
      const span=document.createElement("span");
      span.textContent=p.name; span.className="player-label"; span.style.backgroundColor=p.color;
      playersListDiv.appendChild(span);
    });

    const currentPlayer = players[turnIndex];
    turnInfo.textContent = currentPlayer ? `Tour du joueur ${currentPlayer.name}` : "";

    lettersDiv.querySelectorAll("button").forEach(b=>{
      b.disabled = guessedLetters.includes(b.textContent) || gameSnap.gameOver || !currentPlayer || currentPlayer.name!==player;
    });

    if(gameSnap.gameOver){
      if(attemptsLeft<=0){ soundLose.play(); statusDiv.textContent=`üíÄ Partie termin√©e, le mot √©tait "${currentWord}"`; }
      else { soundWin.play(); statusDiv.textContent=`üéâ Partie termin√©e, le mot a √©t√© trouv√© !`; }
    }
  });
}

// --- Attacher listener apr√®s cr√©ation ou rejoindre ---
document.getElementById("create-game").onclick = ()=>{ 
  player = document.getElementById("player-name").value||"Joueur";
  playerColor="#"+Math.floor(Math.random()*16777215).toString(16);
  gameCode = generateGameCode();
  currentWord = words[Math.floor(Math.random()*words.length)];
  attemptsLeft = maxAttempts;
  guessedLetters=[];
  db.ref(`games/${gameCode}`).set({
    currentWord: currentWord,
    guessedLetters: guessedLetters,
    attemptsLeft: attemptsLeft,
    turnIndex:0,
    gameOver:false,
    players:[{name:player,color:playerColor}]
  });
  gameCodeDisplay.textContent = "Code de la partie : " + gameCode;
  homeDiv.style.display="none"; gameDiv.style.display="block"; generateLetterButtons();
  attachGameListener();
};

document.getElementById("join-game").onclick = ()=>{
  player = document.getElementById("player-name").value||"Joueur";
  playerColor="#"+Math.floor(Math.random()*16777215).toString(16);
  gameCode = joinCodeInput.value.trim();
  if(!gameCode){alert("Entrez un code valide"); return;}
  db.ref(`games/${gameCode}/players`).once("value").then(snap=>{
    players = snap.val()||[];
    if(!players.some(p=>p.name===player)){
      players.push({name:player,color:playerColor});
      db.ref(`games/${gameCode}/players`).set(players);
    }
    homeDiv.style.display="none"; gameDiv.style.display="block"; generateLetterButtons();
    attachGameListener();
  });
};

// --- Retour au menu ---
document.getElementById("new-game").onclick=()=>{
  gameCode = "";
  homeDiv.style.display="block";
  gameDiv.style.display="none";
  gameCodeDisplay.textContent="";
};
</script>
</body>
</html>
