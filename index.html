<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cowboy Pendu Multijoueur Priv√©</title>

<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; margin:0; padding:0; display:flex; flex-direction:column; align-items:center;}
header { background:#8b4513; color:white; padding:20px; width:100%; text-align:center;}
main { display:flex; flex-wrap:wrap; justify-content:center; margin:20px; width:100%; max-width:1200px;}
#game-container { flex:3; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); margin-bottom:20px;}
#scoreboard { flex:1; margin-left:20px; min-width:200px; background:#fff8dc; padding:15px; border-radius:10px;}
button { padding:10px 20px; margin:5px; border-radius:5px; border:none; cursor:pointer;}
#word-display { font-size:2em; letter-spacing:10px; margin:20px 0; text-align:center;}
#letters button { width:40px; height:40px; margin:2px;}
#error-message { color:red; }
</style>
</head>

<body>

<header>
<h1>Cowboy Pendu Multijoueur Priv√© ü§†</h1>
</header>

<main>
<div id="game-container">

<div id="join-create">
    <input id="player-name" placeholder="Votre pseudo">
    <button onclick="createRoom()">Cr√©er Partie</button><br><br>
    <input id="room-id" placeholder="Code de la partie">
    <button onclick="joinRoom()">Rejoindre Partie</button>
    <p id="error-message"></p>
</div>

<div id="room-info" style="display:none;">
    <p id="current-room"></p>
    <div id="word-display"></div>
    <div id="letters"></div>
    <p id="status"></p>
    <button onclick="location.reload()">Quitter</button>
</div>

</div>
</main>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// üîπ FIREBASE CONFIG (CORRIG√âE)
const firebaseConfig = {
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8XQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.appspot.com",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// üîπ VARIABLES
const words = ["cowboy","cheval","lasso","saloon","pistolet"];
let roomId = "";
let playerName = "";

// üîπ CREATE ROOM
function createRoom() {
    playerName = document.getElementById("player-name").value.trim();
    if (!playerName) {
        document.getElementById("error-message").textContent = "Entre un pseudo";
        return;
    }

    roomId = Math.random().toString(36).substring(2,8).toUpperCase();
    const word = words[Math.floor(Math.random()*words.length)];

    db.ref("rooms/" + roomId).set({
        word: word,
        players: { [playerName]: 0 },
        guessed: [],
        attempts: 6
    }).then(() => {
        enterRoom();
    }).catch(err => {
        alert("Erreur Firebase");
        console.error(err);
    });
}

// üîπ JOIN ROOM
function joinRoom() {
    playerName = document.getElementById("player-name").value.trim();
    roomId = document.getElementById("room-id").value.toUpperCase();

    if (!playerName || !roomId) return;

    db.ref("rooms/" + roomId).once("value").then(snap => {
        if (!snap.exists()) {
            alert("Partie introuvable");
            return;
        }
        db.ref(`rooms/${roomId}/players/${playerName}`).set(0);
        enterRoom();
    });
}

// üîπ ENTER ROOM
function enterRoom() {
    document.getElementById("join-create").style.display = "none";
    document.getElementById("room-info").style.display = "block";
    document.getElementById("current-room").textContent = "Code : " + roomId;

    db.ref("rooms/" + roomId).on("value", snap => {
        const data = snap.val();
        if (!data) return;

        let display = "";
        for (let l of data.word) {
            display += data.guessed.includes(l) ? l+" " : "_ ";
        }
        document.getElementById("word-display").textContent = display;

        const lettersDiv = document.getElementById("letters");
        lettersDiv.innerHTML = "";

        "abcdefghijklmnopqrstuvwxyz".split("").forEach(letter => {
            const btn = document.createElement("button");
            btn.textContent = letter;
            btn.disabled = data.guessed.includes(letter);

            btn.onclick = () => {
                data.guessed.push(letter);
                if (!data.word.includes(letter)) data.attempts--;
                db.ref("rooms/" + roomId).update({
                    guessed: data.guessed,
                    attempts: data.attempts
                });
            };

            lettersDiv.appendChild(btn);
        });

        document.getElementById("status").textContent =
            data.attempts <= 0 ? "üíÄ Perdu !" :
            !display.includes("_") ? "üéâ Gagn√© !" :
            "Essais restants : " + data.attempts;
    });
}
</script>

</body>
</html>
