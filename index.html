<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cowboy Pendu ðŸ¤ </title>

<style>
body { font-family: Arial; background:#eee; text-align:center; }
#game { background:white; padding:20px; margin:20px auto; width:400px; border-radius:10px; }
#word { font-size:32px; letter-spacing:10px; margin:20px; }
#letters button { width:35px; height:35px; margin:2px; }
</style>
</head>

<body>
  <script>
alert("SI TU VOIS CE MESSAGE, LE JS MARCHE");
</script>


<h1>Cowboy Pendu ðŸ¤ </h1>

<div id="game">

<div id="menu">
  <input id="name" placeholder="Pseudo"><br><br>
  <button onclick="createRoom()">CrÃ©er</button><br><br>
  <input id="roomInput" placeholder="Code">
  <button onclick="joinRoom()">Rejoindre</button>
</div>

<div id="room" style="display:none;">
  <p id="roomCode"></p>
  <div id="word">_ _ _ _</div>
  <div id="letters"></div>
  <p id="status"></p>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8XQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.appspot.com",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d"
});

const db = firebase.database();

/* ðŸŽ® VARIABLES */
const words = ["cowboy","cheval","lasso","saloon"];
let roomId = "";
let localWord = "";
let guessed = [];
let attempts = 6;

/* ðŸ†• CREATE */
function createRoom() {
  roomId = Math.random().toString(36).substring(2,8).toUpperCase();
  localWord = words[Math.floor(Math.random()*words.length)];
  guessed = [];
  attempts = 6;

  db.ref("rooms/"+roomId).set({
    word: localWord,
    guessed: [],
    attempts: 6
  });

  enterRoom();
}

/* ðŸ”‘ JOIN */
function joinRoom() {
  roomId = roomInput.value.toUpperCase();
  db.ref("rooms/"+roomId).once("value").then(snap=>{
    if(!snap.exists()) return alert("Partie introuvable");
    enterRoom();
  });
}

/* ðŸšª ENTER */
function enterRoom() {
  menu.style.display="none";
  room.style.display="block";
  roomCode.textContent="Code : "+roomId;

  // âš ï¸ AFFICHE TOUJOURS UN MOT
  renderWord();

  db.ref("rooms/"+roomId).on("value", snap=>{
    const d = snap.val();
    if(!d) return;
    localWord = d.word;
    guessed = d.guessed || [];
    attempts = d.attempts;
    renderWord();
  });

  renderLetters();
}

/* ðŸ”¤ MOT */
function renderWord() {
  let out="";
  for(let l of localWord){
    out += guessed.includes(l) ? l+" " : "_ ";
  }
  word.textContent = out || "_ _ _ _";
  status.textContent = "Essais : "+attempts;
}

/* ðŸ”˜ LETTRES */
function renderLetters() {
  letters.innerHTML="";
  "abcdefghijklmnopqrstuvwxyz".split("").forEach(l=>{
    const b=document.createElement("button");
    b.textContent=l;
    b.disabled=guessed.includes(l)||attempts<=0;
    b.onclick=()=>{
      if(guessed.includes(l)) return;
      guessed.push(l);
      if(!localWord.includes(l)) attempts--;
      db.ref("rooms/"+roomId).update({
        guessed: guessed,
        attempts: attempts
      });
    };
    letters.appendChild(b);
  });
}
</script>

</body>
</html>

