<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Pendu Cowboy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- üî• Firebase v8 (OBLIGATOIRE POUR HTML SIMPLE) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background:#222;
    color:#fff;
    text-align:center;
    padding:30px;
}
input, button {
    padding:10px;
    margin:5px;
    font-size:16px;
}
button {
    cursor:pointer;
}
</style>
</head>

<body>

<h1>ü§† Pendu Cowboy</h1>

<div id="menu">
    <input id="playerName" placeholder="Pseudo">
    <input id="roomIdInput" placeholder="Code partie">
    <input id="numGames" type="number" value="3" min="1">
    <br>
    <button onclick="createRoom()">Cr√©er une partie</button>
    <button onclick="joinRoom()">Rejoindre une partie</button>
</div>

<p id="status"></p>

<script>
/* ================= FIREBASE CONFIG (D√âJ√Ä REMPLI) ================= */

const firebaseConfig = {
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8bXQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.firebasestorage.app",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d"
};

/* üî• INITIALISATION FIREBASE */
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= VARIABLES ================= */

const words = ["cowboy","cheval","lasso","saloon"];
let playerName = "";
let roomId = "";

/* ================= CR√âER UNE PARTIE ================= */

function createRoom(){
    playerName = document.getElementById("playerName").value.trim();
    const totalGames = parseInt(document.getElementById("numGames").value) || 3;

    if(!playerName){
        alert("Pseudo obligatoire");
        return;
    }

    roomId = Math.random().toString(36).substring(2,8).toUpperCase();
    const word = words[Math.floor(Math.random()*words.length)];

    db.ref("rooms/"+roomId).set({
        word: word,
        attemptsLeft: 6,
        totalGames: totalGames,
        gamesPlayed: 0,
        guessedLetters: {},
        players: { [playerName]: true },
        scores: { [playerName]: 0 },
        replayRequests: {}
    }).then(()=>{
        document.getElementById("status").innerText =
            "‚úÖ Partie cr√©√©e ! Code : " + roomId;
    }).catch(err=>{
        alert("Erreur cr√©ation : "+err.message);
    });
}

/* ================= REJOINDRE UNE PARTIE ================= */

function joinRoom(){
    playerName = document.getElementById("playerName").value.trim();
    roomId = document.getElementById("roomIdInput").value.trim().toUpperCase();

    if(!playerName || !roomId){
        alert("Pseudo et code requis");
        return;
    }

    db.ref("rooms/"+roomId).once("value").then(snap=>{
        if(!snap.exists()){
            alert("Partie introuvable");
            return;
        }

        db.ref("rooms/"+roomId+"/players/"+playerName).set(true);
        db.ref("rooms/"+roomId+"/scores/"+playerName).set(0);

        document.getElementById("status").innerText =
            "‚úÖ Rejoint la partie " + roomId;
    }).catch(err=>{
        alert("Erreur rejoindre : "+err.message);
    });
}
</script>
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// üîπ TEST RAPIDE
db.ref("TEST").set({ ok: true })
  .then(() => alert("‚úÖ Firebase OK"))
  .catch(err => alert("‚ùå Firebase bloqu√© : " + err.message));

</body>
</html>

