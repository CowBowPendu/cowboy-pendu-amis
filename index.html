<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Cowboy Pendu Multijoueur ðŸ¤ </title>
<style>
body { font-family: Arial; background:#eee; text-align:center; }
#game { background:white; padding:20px; margin:20px auto; width:400px; border-radius:10px; }
#word { font-size:32px; letter-spacing:10px; margin:20px; }
#letters button { width:35px; height:35px; margin:2px; }
#leaderboard { margin-top:20px; text-align:left; max-width:400px; margin-left:auto; margin-right:auto; }
</style>
</head>

<body>

<h1>Cowboy Pendu Multijoueur ðŸ¤ </h1>

<div id="game">

<div id="menu">
  <input id="name" placeholder="Pseudo"><br><br>
  <button onclick="createRoom()">CrÃ©er</button><br><br>
  <input id="roomInput" placeholder="Code">
  <button onclick="joinRoom()">Rejoindre</button>
  <p id="error"></p>
</div>

<div id="room" style="display:none;">
  <p id="roomCode"></p>
  <div id="word">_ _ _ _</div>
  <div id="letters"></div>
  <p id="status"></p>
  <button onclick="restartGame()">Rejouer</button>
  <div id="leaderboard"><h3>Classement</h3><ul id="scores"></ul></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ðŸ”¥ FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8XQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.appspot.com",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d"
});

const db = firebase.database();

const words = ["cowboy","cheval","lasso","saloon","pistolet"];
let roomId = "";
let player = "";
let localWord = "";
let guessed = [];
let attempts = 6;

// ðŸ”¹ CrÃ©er une partie
function createRoom() {
  player = name.value.trim();
  if(!player) return error.textContent="Entre un pseudo";
  roomId = Math.random().toString(36).substring(2,8).toUpperCase();
  localWord = words[Math.floor(Math.random()*words.length)];
  guessed = [];
  attempts = 6;

  db.ref("rooms/"+roomId).set({
    word: localWord,
    guessed: [],
    attempts: 6,
    players: {[player]:0}
  });

  enterRoom();
}

// ðŸ”¹ Rejoindre
function joinRoom() {
  player = name.value.trim();
  roomId = roomInput.value.trim().toUpperCase();
  if(!player||!roomId) return;

  db.ref("rooms/"+roomId).once("value").then(snap=>{
    if(!snap.exists()) return error.textContent="Partie introuvable";
    // ajoute joueur si pas existant
    let data = snap.val();
    if(!data.players[player]) data.players[player]=0;
    db.ref("rooms/"+roomId+"/players").set(data.players);
    enterRoom();
  });
}

// ðŸ”¹ Entrer dans la room
function enterRoom() {
  menu.style.display="none";
  room.style.display="block";
  roomCode.textContent="Code : "+roomId;
  renderWord();
  renderLetters();

  db.ref("rooms/"+roomId).on("value", snap=>{
    const d = snap.val();
    if(!d) return;
    localWord = d.word;
    guessed = d.guessed || [];
    attempts = d.attempts;
    renderWord();
    renderLetters();
    renderLeaderboard(d.players || {});
  });
}

// ðŸ”¹ Affichage du mot
function renderWord() {
  let out="";
  for(let l of localWord){
    out += guessed.includes(l)?l+" ":"_ ";
  }
  word.textContent = out;
  if(attempts<=0) status.textContent="ðŸ’€ Perdu ! Mot : "+localWord;
  else if(!out.includes("_")) status.textContent="ðŸŽ‰ GagnÃ© !";
  else status.textContent="Essais : "+attempts;
}

// ðŸ”¹ Lettres
function renderLetters() {
  letters.innerHTML="";
  if(attempts<=0 || !localWord) return;
  "abcdefghijklmnopqrstuvwxyz".split("").forEach(l=>{
    const btn=document.createElement("button");
    btn.textContent=l;
    btn.disabled=guessed.includes(l) || attempts<=0;
    btn.onclick=()=>{ 
      if(guessed.includes(l)) return;
      guessed.push(l);
      if(!localWord.includes(l)) attempts--;
      // incrÃ©mente score si trouvÃ©
      let scoreUpdate = {};
      if(localWord.includes(l)) scoreUpdate[player] = (document.getElementById("scores").dataset[player]||0)+1;
      db.ref("rooms/"+roomId).update({guessed:guessed,attempts:attempts});
      if(localWord.includes(l)) {
        db.ref("rooms/"+roomId+"/players/"+player).transaction(v=>(v||0)+1);
      }
    };
    letters.appendChild(btn);
  });
}

// ðŸ”¹ Classement
function renderLeaderboard(playersData){
  const ul = document.getElementById("scores");
  ul.innerHTML="";
  for(let p in playersData){
    const li = document.createElement("li");
    li.textContent = `${p} : ${playersData[p]} pts`;
    ul.appendChild(li);
  }
}

// ðŸ”¹ Rejouer
function restartGame() {
  if(!roomId) return;
  localWord = words[Math.floor(Math.random()*words.length)];
  guessed=[];
  attempts=6;
  db.ref("rooms/"+roomId).update({word:localWord,guessed:[],attempts:6});
}
</script>

</body>
</html>
