<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Pendu Cowboy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background:#222;
    color:#fff;
    text-align:center;
    padding:30px;
}
input, button {
    padding:10px;
    margin:5px;
    font-size:16px;
}
button {
    cursor:pointer;
}
#playersList {
    margin-top: 20px;
}
</style>
</head>

<body>

<h1>ðŸ¤  Pendu Cowboy</h1>

<div id="menu">
    <input id="playerName" placeholder="Pseudo">
    <input id="roomIdInput" placeholder="Code partie">
    <input id="numGames" type="number" value="3" min="1">
    <br>
    <button onclick="createRoom()">CrÃ©er une partie</button>
    <button onclick="joinRoom()">Rejoindre une partie</button>
</div>

<p id="status"></p>

<div id="playersList"></div>

<script>
/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyCa4qa1JbAC8ZevEjjsTjtAHp8XQRbTDc",
  authDomain: "cowboy-entre-amis.firebaseapp.com",
  databaseURL: "https://cowboy-entre-amis-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cowboy-entre-amis",
  storageBucket: "cowboy-entre-amis.firebasestorage.app",
  messagingSenderId: "561482687512",
  appId: "1:561482687512:web:846729411c9158d3ea0f6d"
};

/* ðŸ”¹ INITIALISATION */
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= VARIABLES ================= */
const words = ["cowboy","cheval","lasso","saloon"];
let playerName = "";
let roomId = "";

/* ================= CRÃ‰ER UNE PARTIE ================= */
function createRoom(){
    playerName = document.getElementById("playerName").value.trim();
    const totalGames = parseInt(document.getElementById("numGames").value) || 3;

    if(!playerName){
        alert("Pseudo obligatoire");
        return;
    }

    roomId = Math.random().toString(36).substring(2,8).toUpperCase();
    const word = words[Math.floor(Math.random()*words.length)];

    db.ref("rooms/"+roomId).set({
        word: word,
        attemptsLeft: 6,
        totalGames: totalGames,
        gamesPlayed: 0,
        guessedLetters: {},
        players: { [playerName]: true },
        scores: { [playerName]: 0 },
        replayRequests: {}
    }).then(()=>{
        document.getElementById("status").innerText =
            "âœ… Partie crÃ©Ã©e ! Code : " + roomId;
        updatePlayersList();
    }).catch(err=>{
        alert("Erreur crÃ©ation : "+err.message);
    });
}

/* ================= REJOINDRE UNE PARTIE ================= */
function joinRoom(){
    playerName = document.getElementById("playerName").value.trim();
    roomId = document.getElementById("roomIdInput").value.trim().toUpperCase();

    if(!playerName || !roomId){
        alert("Pseudo et code requis");
        return;
    }

    const roomRef = db.ref("rooms/" + roomId);

    roomRef.once("value")
    .then(snapshot => {
        if(!snapshot.exists()){
            alert("Partie introuvable !");
            return;
        }

        const data = snapshot.val();

        if(!data.players || !data.players[playerName]){
            roomRef.child("players/" + playerName).set(true);
            roomRef.child("scores/" + playerName).set(0);
        }

        document.getElementById("status").innerText =
            "âœ… Rejoint la partie " + roomId;

        updatePlayersList();
    })
    .catch(err => {
        console.error(err);
        alert("Erreur rejoindre : " + err.message);
    });
}

/* ================= LISTE DES JOUEURS ================= */
function updatePlayersList(){
    if(!roomId) return;

    const playersRef = db.ref("rooms/" + roomId + "/players");

    playersRef.on("value", snapshot => {
        const data = snapshot.val() || {};
        const names = Object.keys(data);
        document.getElementById("playersList").innerText =
            "Joueurs dans la partie : " + names.join(", ");
    });
}
</script>

</body>
</html>
