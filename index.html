<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Pendu Cowboy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #222;
            color: #fff;
            text-align: center;
            padding: 30px;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
        }
        button {
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>ðŸ¤  Pendu Cowboy</h1>

<div id="menu">
    <input id="playerName" placeholder="Pseudo">
    <input id="roomIdInput" placeholder="Code partie">
    <input id="numGames" type="number" value="3" min="1">
    <br>
    <button onclick="createRoom()">CrÃ©er une partie</button>
    <button onclick="joinRoom()">Rejoindre une partie</button>
</div>

<div id="status"></div>

<script>
/* ================= FIREBASE CONFIG ================= */

const firebaseConfig = {
    apiKey: "REMPLACE_API_KEY",
    authDomain: "REMPLACE.firebaseapp.com",
    databaseURL: "https://REMPLACE-default-rtdb.firebaseio.com",
    projectId: "REMPLACE",
    storageBucket: "REMPLACE.appspot.com",
    messagingSenderId: "REMPLACE",
    appId: "REMPLACE"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= VARIABLES ================= */

const words = ["cowboy", "cheval", "lasso", "saloon"];
let playerName = "";
let roomId = "";

/* ================= CREATE ROOM ================= */

function createRoom() {
    playerName = document.getElementById("playerName").value.trim();
    const totalGames = parseInt(document.getElementById("numGames").value) || 3;

    if (!playerName) {
        alert("Pseudo obligatoire");
        return;
    }

    roomId = Math.random().toString(36).substring(2, 8).toUpperCase();
    const word = words[Math.floor(Math.random() * words.length)];

    console.log("CrÃ©ation room :", roomId);

    db.ref("rooms/" + roomId).set({
        word: word,
        players: { [playerName]: true },
        guessedLetters: {},
        attemptsLeft: 6,
        totalGames: totalGames,
        gamesPlayed: 0,
        replayRequests: {},
        scores: { [playerName]: 0 }
    })
    .then(() => {
        document.getElementById("status").innerText =
            "âœ… Partie crÃ©Ã©e ! Code : " + roomId;
    })
    .catch(err => {
        console.error(err);
        alert("Erreur crÃ©ation : " + err.message);
    });
}

/* ================= JOIN ROOM ================= */

function joinRoom() {
    playerName = document.getElementById("playerName").value.trim();
    roomId = document.getElementById("roomIdInput").value.trim().toUpperCase();

    if (!playerName || !roomId) {
        alert("Pseudo et code requis");
        return;
    }

    db.ref("rooms/" + roomId).once("value")
    .then(snapshot => {
        if (!snapshot.exists()) {
            alert("Partie introuvable");
            return;
        }

        db.ref("rooms/" + roomId + "/players/" + playerName).set(true);
        db.ref("rooms/" + roomId + "/scores/" + playerName).set(0);

        document.getElementById("status").innerText =
            "âœ… Rejoint la partie " + roomId;
    })
    .catch(err => {
        console.error(err);
        alert("Erreur rejoindre : " + err.message);
    });
}
</script>

</body>
</html>
